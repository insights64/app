<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insights64 - Chess Coaching Dashboard</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">

  <!-- Fonts - Lora for headings, Poppins for body -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Poppins', 'system-ui', 'sans-serif'],
            serif: ['Lora', 'Georgia', 'serif'],
          },
          colors: {
            anthro: {
              dark: '#141413',
              light: '#faf9f5',
              cream: '#f5f3ef',
              gray: '#6b6962',
              'gray-mid': '#8a877f',
              'gray-light': '#e8e6dc',
              orange: '#d97757',
              'orange-dark': '#c15f3c',
              blue: '#6a9bcc',
              green: '#788c5d',
            }
          }
        }
      }
    }
  </script>
  <style>
    ::selection {
      background-color: #d97757;
      color: white;
    }

    /* Custom scrollbar for a cleaner look */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }

    /* Tooltip styles */
    .tag-tooltip-wrapper {
      position: relative;
      display: inline-block;
    }

    .tag-tooltip {
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: #f9fafb;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 12px;
      line-height: 1.4;
      width: max-content;
      max-width: 280px;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
      z-index: 9999;
      pointer-events: none;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.15s ease, visibility 0.15s ease;
    }

    /* Tooltip arrow */
    .tag-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: #1f2937;
    }

    /* Show tooltip on hover with delay */
    .tag-tooltip-wrapper:hover .tag-tooltip,
    .tag-tooltip-wrapper:focus-within .tag-tooltip {
      opacity: 1;
      visibility: visible;
      transition-delay: 200ms;
    }

    /* Tooltip repositioning for edge cases */
    .tag-tooltip-wrapper:hover .tag-tooltip.tooltip-right,
    .tag-tooltip-wrapper:focus-within .tag-tooltip.tooltip-right {
      left: 0;
      transform: translateX(0);
    }
    .tag-tooltip.tooltip-right::after {
      left: 16px;
      transform: translateX(0);
    }

    .tag-tooltip-wrapper:hover .tag-tooltip.tooltip-left,
    .tag-tooltip-wrapper:focus-within .tag-tooltip.tooltip-left {
      left: auto;
      right: 0;
      transform: translateX(0);
    }
    .tag-tooltip.tooltip-left::after {
      left: auto;
      right: 16px;
      transform: translateX(0);
    }

    /* Tooltip content styles */
    .tag-tooltip-title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 4px;
      color: #ffffff;
    }

    .tag-tooltip-desc {
      color: #d1d5db;
      margin-bottom: 6px;
    }

    .tag-tooltip-move {
      color: #9ca3af;
      font-size: 11px;
      padding-top: 6px;
      border-top: 1px solid #374151;
    }

    /* Tooltip below variant (for use in scrollable containers) */
    .tag-tooltip.tooltip-below {
      bottom: auto;
      top: calc(100% + 8px);
    }
    .tag-tooltip.tooltip-below::after {
      top: auto;
      bottom: 100%;
      border-top-color: transparent;
      border-bottom-color: #1f2937;
    }

    /* Mobile: tap to show */
    @media (hover: none) {
      .tag-tooltip-wrapper {
        cursor: pointer;
      }
      .tag-tooltip-wrapper:focus .tag-tooltip,
      .tag-tooltip-wrapper:active .tag-tooltip {
        opacity: 1;
        visibility: visible;
      }
    }
  </style>
</head>
<body class="bg-anthro-light min-h-screen font-sans antialiased">
  <div id="app"></div>
  <script src="/elm.js"></script>
  <script>
    // API URL configuration - injected at build time
    // http://localhost:8080 is replaced by the build script with the actual URL
    const API_URL = 'http://localhost:8080' !== '__' + 'API_URL__'
      ? 'http://localhost:8080'
      : 'http://localhost:8080';

    // Initialize Elm app with token, coach data, API URL, and time range filter from localStorage
    const app = Elm.Main.init({
      node: document.getElementById('app'),
      flags: {
        token: localStorage.getItem('insights64_token'),
        coach: JSON.parse(localStorage.getItem('insights64_coach')),
        apiUrl: API_URL,
        timeRangeFilter: localStorage.getItem('insights64_time_range_filter')
      }
    });

    // Port: Save token to localStorage
    if (app.ports.saveToken) {
      app.ports.saveToken.subscribe(function(token) {
        localStorage.setItem('insights64_token', token);
      });
    }

    // Port: Clear token and coach data from localStorage
    if (app.ports.clearToken) {
      app.ports.clearToken.subscribe(function() {
        localStorage.removeItem('insights64_token');
        localStorage.removeItem('insights64_coach');
      });
    }

    // Port: Save coach data to localStorage
    if (app.ports.saveCoach) {
      app.ports.saveCoach.subscribe(function(coach) {
        localStorage.setItem('insights64_coach', JSON.stringify(coach));
      });
    }

    // Port: Identify user for LogRocket
    if (app.ports.identifyUser) {
      app.ports.identifyUser.subscribe(function(user) {
        if (window.LogRocket) {
          window.LogRocket.identify(user.id, {
            email: user.email
          });
        }
      });
    }

    // Port: Save time range filter to localStorage
    if (app.ports.saveTimeRangeFilter) {
      app.ports.saveTimeRangeFilter.subscribe(function(filter) {
        localStorage.setItem('insights64_time_range_filter', filter);
      });
    }
  </script>

  <!-- LogRocket -->
  <script src="https://cdn.logr-in.com/LogRocket.min.js" crossorigin="anonymous"></script>
  <script>window.LogRocket && window.LogRocket.init('insights64/insights64');</script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7KCFYKSHGW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-7KCFYKSHGW');
  </script>

  <!-- Crisp Chat -->
  <script type="text/javascript">window.$crisp=[];window.CRISP_WEBSITE_ID="d8e553e6-d444-4c60-9984-630e2090c769";(function(){d=document;s=d.createElement("script");s.src="https://beta.client.crisp.chat/l.js";s.async=1;d.getElementsByTagName("head")[0].appendChild(s);})();</script>
</body>
</html>
